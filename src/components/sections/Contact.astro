---
import type { ContactContent, Location, SocialLink } from '../../types';
import LocationCard from '../cards/LocationCard.astro';

const contactData = (await import('../../content/contact.json')).default as ContactContent;

const phoneNumber: string = contactData.phoneNumber || "";
const phoneNumberClean: string =
    contactData.phoneNumberClean ||
    contactData.phoneNumber?.replace(/\D/g, "") ||
    "";

const socialLinks: SocialLink[] = contactData.socialLinks || [];
const hours = contactData.hours || [];
const addressLines = contactData.addressLines || [];

const locationsModules = import.meta.glob<{ default: Location }>(
    '../../content/locations/*.json',
    { eager: true }
);

const locations: Location[] = Object.values(locationsModules)
    .map((module) => module.default)
    .sort((a, b) => (a.order ?? 0) - (b.order ?? 0));
---

<section id="contact" class="section teal-bg">
    <div class="container">
        <h2 class="section-title">
            <i class="fas fa-map-marker-alt"></i> Contáctanos
        </h2>
        
        <!-- Contact Info Cards -->
        <div class="columns">
            <div class="column is-8 is-offset-2">
                <div
                    class="box has-background-light"
                    style="border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);"
                >
                    <div class="content">
                        <div class="columns is-mobile">
                            <div class="column has-text-centered">
                                <span
                                    class="icon is-large"
                                    style="color: var(--isho-dark-pink);"
                                >
                                    <i class="fas fa-3x fa-store"></i>
                                </span>
                                <h3
                                    class="title is-5"
                                    style="color: var(--isho-dark-pink); margin-top: 1rem;"
                                >
                                    Visítanos
                                </h3>
                                <p>
                                    {
                                        addressLines.length
                                            ? addressLines.map((line, index) => (
                                                <>
                                                    {line}
                                                    {index < addressLines.length - 1 && <br />}
                                                </>
                                            ))
                                            : "Actualiza la dirección en el CMS."
                                    }
                                </p>
                            </div>
                            <div class="column has-text-centered">
                                <span
                                    class="icon is-large"
                                    style="color: var(--isho-dark-pink);"
                                >
                                    <i class="fas fa-3x fa-phone"></i>
                                </span>
                                <h3
                                    class="title is-5"
                                    style="color: var(--isho-dark-pink); margin-top: 1rem;"
                                >
                                    Llámanos
                                </h3>
                                <div class="contact-buttons">
                                    <a
                                        href={`tel:${phoneNumber}`}
                                        class="button contact-btn call-btn"
                                    >
                                        <i class="fas fa-phone" style="margin-right: 0.5rem;"></i>
                                        Llamar
                                    </a>
                                    <a
                                        href={`https://wa.me/${phoneNumberClean}`}
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        class="button contact-btn whatsapp-btn"
                                    >
                                        <i class="fab fa-whatsapp" style="margin-right: 0.5rem;"></i>
                                        WhatsApp
                                    </a>
                                </div>
                            </div>
                            <div class="column has-text-centered">
                                <span
                                    class="icon is-large"
                                    style="color: var(--isho-dark-pink);"
                                >
                                    <i class="fas fa-3x fa-clock"></i>
                                </span>
                                <h3
                                    class="title is-5"
                                    style="color: var(--isho-dark-pink); margin-top: 1rem;"
                                >
                                    Horario
                                </h3>
                                <div>
                                    {
                                        hours.length
                                            ? hours.map((hour) => (
                                                <p>
                                                    {hour.label}<br />{hour.value}
                                                </p>
                                            ))
                                            : <p>Actualiza los horarios en el CMS.</p>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Social Media Section -->
        <div class="columns" style="margin-top: 3rem;">
            <div class="column is-8 is-offset-2">
                <div
                    class="box has-background-light"
                    style="border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);"
                >
                    <div class="content has-text-centered">
                        <h3
                            class="title is-4"
                            style="color: var(--isho-dark-pink); margin-bottom: 1.5rem;"
                        >
                            <i class="fas fa-share-alt" style="margin-right: 0.5rem;"></i>
                            Síguenos en Redes Sociales
                        </h3>
                        <div class="columns is-mobile is-centered">
                            {socialLinks.map((social) => (
                                <div class="column is-narrow">
                                    <a
                                        href={social.url}
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        class="social-link"
                                        style="display: inline-block; padding: 1rem 1.5rem; border-radius: 12px; transition: all 0.3s ease; text-decoration: none;"
                                        aria-label={social.name}
                                    >
                                        <span class="icon is-large">
                                            <i class={social.icon + " fa-2x"} style={`color: ${social.color};`}></i>
                                        </span>
                                        <p
                                            class="is-size-6 has-text-weight-semibold"
                                            style={`color: ${social.color}; margin-top: 0.5rem;`}
                                        >
                                            {social.name}
                                        </p>
                                    </a>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Map Locations Section -->
        <div class="columns is-multiline" style="margin-top: 3rem;">
            {locations.map((location) => (
                <LocationCard
                    name={location.name}
                    address={location.address}
                    embedUrl={location.embedUrl}
                    directionsUrl={location.directionsUrl}
                />
            ))}
        </div>
    </div>
</section>

<style>
    .social-link {
        background: white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .social-link:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }

    .contact-buttons {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        align-items: center;
        width: 100%;
        max-width: 200px;
        margin: 0 auto;
    }

    .contact-btn {
        width: 100%;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        padding: 0.625rem 1rem;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

    .call-btn {
        background: linear-gradient(135deg, var(--isho-teal) 0%, var(--isho-pink) 100%);
        color: white;
    }

    .call-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        color: white;
    }

    .whatsapp-btn {
        background: #25D366;
        color: white;
    }

    .whatsapp-btn:hover {
        background: #20ba5a;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(37, 211, 102, 0.3);
        color: white;
    }

    @media screen and (max-width: 768px) {
        .social-link {
            padding: 0.75rem 1rem !important;
        }
    }
</style>
