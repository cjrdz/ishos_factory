---
declare global {
    interface Window {
        CMS: any;
    }
}
---

<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Content Manager | Isho's Factory</title>
        <meta name="robots" content="noindex" />
        <link href="/admin/config.yml" type="text/yaml" rel="cms-config-url" />
        <link
            rel="stylesheet"
            href="https://unpkg.com/decap-cms@^3.9.0/dist/decap-cms.css"
        />
    </head>
    <body>
        <script src="https://unpkg.com/decap-cms@^3.9.0/dist/decap-cms.js"></script>
        
        <script>
            let loggedIn = false;
            let redirecting = false;
            
            // Watch for DOM changes to detect logout
            const observer = new MutationObserver(function() {
                // Check if login button appears (means user logged out)
                const loginButton = document.querySelector('[class*="AppHeader-button"]');
                const loginText = document.body.textContent || '';
                
                if (loginText.includes('Login') && loggedIn && !redirecting) {
                    console.log('Logout detected, redirecting home...');
                    redirecting = true;
                    setTimeout(function() {
                        window.location.href = '/';
                    }, 500);
                }
                
                // Check if user is logged in
                if (loginText.includes('Men√∫') || loginText.includes('Workflow') || window.location.hash.includes('/collections')) {
                    loggedIn = true;
                }
            });
            
            // Start observing
            observer.observe(document.body, {
                childList: true,
                subtree: true,
                characterData: true
            });
        </script>
    </body>
</html>