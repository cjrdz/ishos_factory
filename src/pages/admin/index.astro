---
declare global {
    interface Window {
        CMS: any;
    }
}
---

<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Content Manager | Isho's Factory</title>
        <meta name="robots" content="noindex" />
        <link href="/admin/config.yml" type="text/yaml" rel="cms-config-url" />
        <link
            rel="stylesheet"
            href="https://unpkg.com/decap-cms@^3.9.0/dist/decap-cms.css"
        />
    </head>
    <body>
        <script src="https://unpkg.com/decap-cms@^3.9.0/dist/decap-cms.js"></script>
        
        <script>
            // Only redirect after an actual logout, not on initial page load
            (function() {
                let hasBeenAuthenticated = false;
                let checkCount = 0;
                const maxChecks = 3; // Only check first few seconds
                
                const checkAuth = setInterval(function() {
                    checkCount++;
                    
                    const hash = window.location.hash;
                    const isInCMS = hash.includes('/collections') || 
                                   hash.includes('/workflow') ||
                                   hash.includes('/edit');
                    
                    // User is authenticated and using the CMS
                    if (isInCMS) {
                        hasBeenAuthenticated = true;
                        checkCount = 0; // Reset counter when in CMS
                    }
                    
                    // Check for logout: was authenticated, now back at login
                    const isAtLogin = hash === '' || hash === '#/' || hash === '#/auth';
                    
                    if (hasBeenAuthenticated && isAtLogin) {
                        console.log('Logout detected - redirecting to homepage');
                        clearInterval(checkAuth);
                        window.location.href = '/';
                    }
                    
                    // Stop checking after initial load period if never authenticated
                    if (!hasBeenAuthenticated && checkCount > maxChecks) {
                        clearInterval(checkAuth);
                    }
                }, 1000);
            })();
        </script>
    </body>
</html>